Write-Host "
@%%%%%%%%%%#%##%%%%#####%%%#:           .-+##***+**=%*+-=:---==:::.. .....::.:.:::::::::::::+######%
%%%##%##%%%%%%%%%%%%%%%%@@@@:           -**##*-=-******+*+=+**+==-..  .....::..::::::.::::::%###%%%%
@%%%%%%%@@%%%%@%@@%@%%%%%@@%:        .:-*****#+**##+###*##*###**+=-:..   :...:..::::...:::::=#####%%
@@%%%%%%%%%%%%%%%%%%#%%#%###.      :=+**###%#*######***#*#**###***+-:    .......::::....:.:::%####%%
%%%%%%#%%%%%####%%%#####%%%#.    -=++*##+-###*+****#*+***++++*+++**-:-. ....::..::::........:%####%%
%#%#%#%#%%%%%%%%%%%%%%%%%@@@#-==++*#%%##+-+#**++===--:::.:...::--=-++-++--.:....::..........:%####%%
@@@%%%%%%%%%%%%%%%%%%%%%%%%%+=+**##%%##*+=++=-::::..              .:-==+*#*=::..:..:........:###%#%%
@@%%%%%%%%%%%%%####%#######*++*#%#%#*+===--+-...                     :-=***+:-:.............+#####%%
@%%%%%%%%%#%##%#*#*###***+-=+=+#%##+==----=-.                         ::+**#**-::...........%######%
%%########%%##%%%%%%+#%**+===+*%%#+=--:--:--.                          .-+*****:...........%#######%
#**#****########*+++---. :**+%##*=-:::::---...                         .:=+****=:.........@%%###%%#%
                     :++=-=**%#*=-::::-==:.                             .-+****+::........*@%%%%%%%@
                         ++*##*=----:-:--:.                             .:=****+.....  ... @%%#%##%%
                         -*+##*-:-=---:..                               .:=****+.......    @#######%
                         +###*+--=---....                               .:=**#**.....      @####%%%%
                         .#%##+------..... ...  ...                      :=+****....   .  .%##%##%#%
                          *%##==--=++=--:..........  ... .....::::..:.   .-+*#*:.... ...  %%#####%#%
                          .%#+--++****++*+=---::.:......:--++*###**+=---  .+*##%. ...    +%####%###%
                           %*+++=:::++***+=+==---::...::---+####%***=-::   +*#%#.... .  -%%%###%#%#%
                          -%@*+---*%%--:..+##==--:.  .:::+**+:++: =**+..   -#*#:..... . %%%%%######%
:                          #@----=**+-:%#%%-**+==.    .-++==:+#%#*:: ==.   -*-:.. .      %%%##%###%#
---                        *%-:---==++=*=+****++...   .:+**+==-:   .:.     :++-..        +%#########
:.:::                      +#-:-==++=-:-=+++++++..    ...:-----===.    :-...=+-... .     -%%%%###%#%
::.::-                     =*-:---==++*+++=::===-.    ........::::.     .:..+-- .. .   . *%%#%%#####
=-:.:-:                   .*#----:::. ....::-===-:.  .......:::::...      -:==.   ..     %%%########
:+==:.-.                  -##==-::...  ..:::==---:.  ............    .     :..   . .    +%%%#%####%#
%+:@%*-:.                 #+#=--::.....:--=--==-::.  .......::===-::.:... .     ...    =@%%##%#%##%%
@@%==@#=-                 -:#---::::::-====----::...  .........:-=+=--:. -.     . ..   @@%%%%#%%%%%#
%@@%==@%*-.                :*------=*+=====-----:.... ..:::....::--=++=: -:.  :=..   .+=++#%%%%%#%%%
+=+%%%=%@*-                 *----=#=++==========-:...:=--:......::-+**#=..::......:. .#**##@#=#*++##
*+=%%@**@##+                 .====-+#*+============----:.....:-=+***++%-:.::....... . #***#*%*+%@*+-
%%%@#+%+%@*=-                 ---:-:--%##*=====++++=-..::---===-*##:-=+::+: .....:. . .#***=+###@%**
%#%@+=#+###+-                 .:-::::-:*#=-=======--------:  .: #*.::+.:..-.....:....  =*++++###%@%#
###*+-%+=%*%*-               - ---.:.:==*#   .  :::::          ++....=..:-  ......:.   .%**####%%%%*
#+++--%#+%**#=               +  :--.-.--+*#                   *=....-..::  ...:..... .+.%########%++
%**+--%#*##**+:              =   ---.-.-=++%-               *=-::...:.::....:--@#*=.#*+..%#%#%#%*%*%
#*+---%%#***+++              :    :-=.-:-=++****:   .   :- - ::-.  . ::.:...-:-@%%%####%%%#@@##*+@@@
#*==--%%#*+*+==                     -=.:---+==*..-++*+# :   .:-..    :....:-::+%%%%%###%%%%%#+*%#@@@
#*==--%@%###++=.              :     .-=::---++=:=.:     :..:::.   ..:-- ::-...+%%%%%##%%%%%%%*#%@@@%
#+==--%@@%%#*+=*              + .+-==+==---=-::===--::::::::.      .... :  . -*%%%%%%%%%%%%%%#%%%@#%
*+==--%@@@%%+++*            -**:.::-@:=+=-----::::::......         ::...=-    .%##%%#%#%%%%%%%%%##*#
#*+===+####+**++.      :=++=:-*-=-:#*:=++=-----::::..:.:... .     ::.....%         .@#%%%%%%@%%###*#
*+==-==*%*##%**     :--====--=*-:-=@:-=+++=-:::::.........       +=-.....*             #%%%%@@%%%%*%
*+==-++*#*%%+==-=+=--==+=-=-:=#-::*.:=====++:::::....          .-:.==. ..+                %%%%%@@@#%
#*+=++==      -=++=-:=++===---*--:*=-+======+:::...........   :-::..-+=. *                   *#%*@#%
#**=   . . .-=++++=-:=++=-=:--=---+*=========+-:::.......  ..+=:::. .:==:                       #++%
%-...:-:=--=++++====-=+==--:-+==--=%======--==++=::....:::-++=::...   ..                          +*
.:::::--==:++=++++==-=++--=::++*===+*======-===-+***+*+++=----:...                                  
--------=-++++++++==--+--=--:++#====*+========---======----=-:....                                  
+=----===-**+++++++=-=--==-:-==*=+++=*+====-==-----------==-:...     .                              
                                                                                                                                                                                                                                                                             
Script by                    Oni-kuki                                       " -ForegroundColor Red 
Write-Host "                                Edited by Segners !


*" -ForegroundColor green
# folder creation on the desktop to store the artifacts
if (!(Test-Path -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber")) {
    New-Item -ItemType Directory -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber"
}
# username of the user who launched the script
$username = $env:UserName

# check if the script is run with administrator privileges
$admin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

if ($admin) {
    Write-Host "You are already administrator ! " -ForegroundColor green
}
else {
    throw "it is necessary to run the script with administrator privileges !"
}

function Capturing {
    capture_process
    capture_network
    capture_Hash
    capture_Netconnections
    capture_HKLM
    capture_HKCU
    capture_listProcess
    capture_listServices
    capture_FilesOpened
    capture_itemsFiles
    capture_RecycleBin
    capture_sysInfo
    capture_accountUsage
    capture_netActivity
    capture_extDevice
    capture_sysEvent
    capture_secEvent
    capture_co_location
    capture_co_timestamps
    Hash_Artifacts
}

function capture_process { 
    Write-Host "Capture the running processes and save them in a csv file..." 
    Get-Process -ErrorAction SilentlyContinue | Select-Object Name, Path, CommandLine | Export-Csv -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber\ioc.csv" -NoTypeInformation
    write-host "Process Captured" -ForegroundColor Green
}

function capture_network {
    Write-Host "Capture the network connections and save them in a csv file..."
    Get-NetTCPConnection -ErrorAction SilentlyContinue | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, CreationTime | Export-Csv -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber\netTCPco.csv" -NoTypeInformation 
    Get-NetUDPEndpoint -ErrorAction SilentlyContinue | Select-Object LocalAddress, LocalPort, OwningProcess, CreationTime | Export-Csv -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber\netUDPco.csv" -NoTypeInformation
    write-host "Network TCP/UDP connections Captured" -ForegroundColor Green
}

function capture_Hash {
    Write-Host "Research of the files with the extension .exe, .dll, .sys and save them in a csv file with their hash..."
    Get-ChildItem -Path C:\ -Recurse -Include *.exe,*.dll,*.sys -ErrorAction SilentlyContinue | 
        Get-FileHash -ErrorAction SilentlyContinue | 
        Where-Object { $_.Algorithm -in @('MD5', 'SHA1', 'SHA256') } | 
        Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\known_malware.txt"
    write-host "Files with the extension .exe, .dll, .sys Captured" -ForegroundColor Green
}

function capture_Netconnections {
    Write-Host "Net connections..."
    Get-NetTCPConnection -ErrorAction SilentlyContinue | Where-Object { $_.State -eq 'Established' -and $_.RemoteAddress -notlike '192.168.*' } | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\network_connections.txt"
    write-host "Net connections Captured" -ForegroundColor Green
}

function capture_HKLM {
    write-host "HKLM registar key, taskbar, last visited mru, command executed in run dialog box, bam and dam reg..."
    Get-ChildItem -Path 'HKLM:\Software\Microsoft\Windows\CurrentVersion\Run*','HKLM:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\', 'HKLM:\SYSTEM\CurrentControlSet\Services\bam\State\UserSettings', 'HKLM:\SYSTEM\CurrentControlSet\Services\dam\State\UserSettings' -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\HKLM_malicious_registry_keys.txt"
    write-host "HKLM registar key, taskbar, last visited mru, command executed in run dialog box, bam and dam reg Captured" -ForegroundColor Green
}

function capture_HKCU {
    write-host "HKCU registar key, taskbar, last visited mru, command executed in run dialog box, Run keys, RunOnce keys, RunOnceEx keys, AppCompatCache, FeatureUsage, micro,camera ...usage and USERAssist reg..."
    Get-ChildItem -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Run*', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\','HKCU:\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\','HKCU:\SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache','HKCU:\NTUSER\Software\Microsoft\Windows\CurrentVersion\Explorer\FeatureUsage', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\CapabilityAccessManager\ConsentStore', "HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\UserAssist" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\HKCU_malicious_registry_keys.txt"
    write-host "HKCU registar key, taskbar, last visited mru, command executed in run dialog box, Run keys, RunOnce keys, RunOnceEx keys, AppCompatCache, FeatureUsage, micro,camera ...usage and USERAssist reg Captured" -ForegroundColor Green
}

function capture_listProcess {
    Write-Host "captures the list of processes running on the system, filters the processes that have a valid file path not equal to null..."
    Get-Process -ErrorAction SilentlyContinue | Where-Object { $_.Path -ne $null -and $_.Path -notlike 'C:\Windows*' } | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\running_malware_processes.txt"
    write-host "List of processes running on the system Captured" -ForegroundColor Green
}

function capture_listServices {
    Write-Host "Amcache, Jumplist, Prefetch , USage Monitor..."
    Get-ChildItem -Path "$Env:WinDir\AppCompat\Programs\Amcache.hve", "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations", "$Env:WinDir\Prefetch", "$Env:WinDir\System32\SRU\SRUDB.dat" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Amcache_Jumplist_Prefetch_USageMonitor.txt"
    write-host "Amcache, Jumplist, Prefetch , USage Monitor Captured" -ForegroundColor Green
}

function capture_FilesOpened {
    Write-Host "File and Folder Opening, OpenSaveMRU, RecentDocs, LAStVisitedPidlMRU, SHortcut, shellbags and ShellbagsMRU, Jumplist..."
    Get-ChildItem -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePIDlMR*', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMR*', "$env:USERPROFILE\AppData\Roaming\Microsoft\Office\Recent\", 'HKCU:\SOFTWARE\Microsoft\Windows\Shell\Bag*', "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\Recent\AutomaticDestinations", "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\Recent\CustomDestinations" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\File_and_Folder_Opening.txt"
    write-host "File and Folder Opening, OpenSaveMRU, RecentDocs, LAStVisitedPidlMRU, SHortcut, shellbags and ShellbagsMRU, Jumplist Captured" -ForegroundColor Green
}

function capture_itemsFiles {
    Write-Host "Deleted items and file exitence, Windows search database, worldwheel query, typed path, thumbcache..."
    # Retrait de C:\$Recycle.Bin car pris en charge par capture_RecycleBin
    Get-ChildItem -Path "C:\ProgramData\Microsoft\Search\Data\Applications\Windows\GatherLogs\SystemIndex" , 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuer*', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPath*', "$env:USERPROFILE\AppData\Local\Microsoft\Windows\Explore" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Deleted_items_and_file_exitence.txt"
    write-host "Deleted items and file exitence, Windows search database, worldwheel query, typed path, thumbcache Captured" -ForegroundColor Green
}

function capture_RecycleBin {
    Write-Host "Capturing Recycle Bin contents..."
    $OutDir = "C:\Users\$env:UserName\Desktop\IOC-Grabber"
    $OutFile = "$OutDir\RecycleBin_artifacts.csv"
    
    $Shell = New-Object -ComObject Shell.Application
    $RecycleBin = $Shell.NameSpace(10)
    
    if ($RecycleBin.Items().Count -eq 0) {
        Write-Host "Recycle bin is empty. Empty file created." -ForegroundColor Yellow
        "" | Out-File -Path $OutFile
    }
    else {
        $Results = foreach ($item in $RecycleBin.Items()) {
            [PSCustomObject]@{
                OriginalName = $item.Name
                OriginalPath = $item.Path
                SizeBytes    = $item.Size
                FileType     = $item.Type
                DeletedDate  = $RecycleBin.GetDetailsOf($item, 2) 
            }
        }
        $Results | Export-Csv -Path $OutFile -NoTypeInformation -Encoding UTF8
        Write-Host "Recycle Bin captured successfully" -ForegroundColor Green
    }
}

function capture_sysInfo {
    Write-Host "System information, OS, ComputerName, system BOOT & autostart, last shutdown..."
    Get-ChildItem -Path 'HKCU:\SOFTWARE\Microsoft\Windows NT\CurrentVersion', 'HKLM:\SYSTEM\Setup\BuildUpdat*', 'HKLM:\SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName*', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Run*', 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run*', 'HKLM:\SYSTEM\CurrentControlSet\Services', 'HKLM:\SYSTEM\CurrentControlSet\Control\Window*' -ErrorAction SilentlyContinue | out-file "C:\Users\$env:UserName\Desktop\IOC-Grabber\System_information.txt"
    write-host "System information, OS, ComputerName, system BOOT & autostart, last shutdown Captured" -ForegroundColor Green
}

function capture_accountUsage {
    Write-Host "Account usage, User profile list..."
    Get-ChildItem -Path 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList' -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Account_usage.txt"
    write-host "Account usage, User profile list Captured" -ForegroundColor Green
}

function capture_netActivity {
    Write-Host "Network Activity and Physical Location, Network activity..." 
    Get-ChildItem -Path 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces', 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles' -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Network_Activity.txt"
    write-host "Network Activity and Physical Location, Network activity Captured" -ForegroundColor Green
}

function capture_extDevice {
    Write-Host "External Device/USB Usage, USB, mounted devices..."
    Get-ChildItem -Path 'HKLM:\SYSTEM\CurrentControlSet\Enum\USB', 'HKLM:\SYSTEM\CurrentControlSet\Enum\SCSI', 'HKLM:\SYSTEM\CurrentControlSet\Enum\HID', 'HKLM:\SYSTEM\MountedDevice*', 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\MountPoints2' -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\External_Device_USB_Usage.txt"
    write-host "External Device/USB Usage, USB, mounted devices Captured" -ForegroundColor Green
}

function capture_sysEvent {
    Write-Host "System Event Captured..."
    Get-WinEvent -FilterHashtable @{Logname='System'; id=20001,20003} -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\System_evtx.txt"
    write-host "System Event Captured" -ForegroundColor Green
}

function capture_secEvent {
    if (!(Test-Path -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber\Security-events")) {
        New-Item -ItemType Directory -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber\Security-events" | Out-Null
    }
    $CRITICALIDs = "4618","4649","4719","4765","4766","4794","4897","4964","5124","1102"
    $MEDIUMIDs = "4621","4675","4692","4693","4706","4713","4714","4715","4716","4724","4727","4735","4737","4739","4754","4755","4764","4764","4780","4816","4865","4866","4867","4868","4870","4882","4885","4890","4892","4896","4906","4907","4908","4912","4960","4961","4962","4963","4965","4976","4977","4978","4983","4984","5027","5028","5029","5030","5035","5037","5038","5120","5121","5122","5123","5376","5377","5453","5480","5483","5484","5485","5827","5828","6145","6273","6274","6275","6276","6277","6278","6279","6280","24586","24592","24593","24594"
    $LOWIDs = "4608","4609","4610","4611","4612","4614","4615","4616","4622","4624","4625","4634","4646","4647","4648","4650","4651","4652","4653","4654","4655","4656","4657","4658","4659","4660","4661","4662","4663","4664","4665","4666","4667","4668","4670","4671","4672","4673","4674","4688","4689","4690","4691","4694","4695","4696","4697","4698","4699","4700","4701","4702","4704","4705","4707","4709","4710","4711","4712","4717","4718","4720","4722","4723","4725","4726","4728","4729","4730","4731","4732","4733","4734","4738","4740","4741","4742","4743","4744","4745","4746","4747","4748","4749","4750","4751","4752","4753","4756","4757","4758","4759","4760","4761","4762","4767","4768","4769","4770","4771","4772","4774","4775","4776","4777","4778","4779","4781","4782","4783","4784","4785","4786","4787","4788","4789","4790","4793","4800","4801","4802","4803","4864","4869","4871","4872","4873","4874","4875","4876","4877","4878","4879","4880","4881","4883","4884","4886","4887","4888","4889","4891","4893","4894","4895","4898","4902","4904","4905","4909","4910","4928","4929","4930","4931","4932","4933","4934","4935","4936","4937","4944","4945","4946","4947","4948","4949","4950","4951","4952","4953","4954","4956","4957","4958","4979","4980","4981","4982","4985","5024","5025","5031","5032","5033","5034","5039","5040","5041","5042","5043","5044","5045","5046","5047","5048","5050","5051","5056","5057","5058","5059","5060","5061","5062","5063","5064","5065","5066","5067","5068","5069","5070","5125","5126","5127","5136","5137","5138","5139","5140","5141","5152","5153","5154","5155","5156","5157","5158","5159","5378","5440","5441","5442","5443","5444","5446","5447","5448","5449","5450","5451","5452","5456","5457","5458","5459","5460","5461","5462","5463","5464","5465","5466","5467","5468","5471","5472","5473","5474","5477","5479","5632","5633","5712","5888","5889","5890","6008","6144","6272","24577","24578","24579","24580","24581","24582","24583","24584","24588","24595","24621","5049","5478"

    Write-Host "Grabbing all Security events..."
    Get-WinEvent -FilterHashtable @{Logname='Security'} -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Security-events\Security_evtx_ALL.txt"
    Write-Host "Grabbing Critical Security events..."
    Get-WinEvent -FilterHashtable @{Logname='Security'} -ErrorAction SilentlyContinue | Where-Object { $CRITICALIDs -contains $_.Id } | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Security-events\Security_evtx_CRITICAL.txt"
    Write-Host "Grabbing Medium Security events..."
    Get-WinEvent -FilterHashtable @{Logname='Security'} -ErrorAction SilentlyContinue | Where-Object { $MEDIUMIDs -contains $_.Id } | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Security-events\Security_evtx_MEDIUM.txt"
    Write-Host "Grabbing Low Security events..."
    Get-WinEvent -FilterHashtable @{Logname='Security'} -ErrorAction SilentlyContinue | Where-Object { $LOWIDs -contains $_.Id } | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Security-events\Security_evtx_LOW.txt"
    Write-Host "Security events grabbed..." -ForegroundColor Green
}

function capture_co_location {
    Write-Host "Grabbing Connection Location..."
    Get-ChildItem -Path "$env:USERPROFILE\AppData\Local\Microsoft\Windows\UsrClass.dat" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Connection_location.txt"
    Get-Content -Path "$Env:WinDir\inf\setupapi.dev.log" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Connection_timestamps.txt"
    Write-Host "Connection Location grabbed..." -ForegroundColor Green
}

function capture_co_timestamps {
    Write-Host "Grabbing Connection timestamps..."
    Get-WinEvent -Path "$Env:WinDir\System32\winevt\logs\Microsoft-Windows-Partition*" -ErrorAction SilentlyContinue | Out-File "C:\Users\$env:UserName\Desktop\IOC-Grabber\Connection_timestamps.txt"
    Write-Host "Connection timestamps grabbed..." -ForegroundColor Green
}

function Hash_Artifacts {
    Write-Host "Hash of artifacts in progress..."
    $dateTime = Get-Date -Format yyyyMMdd-HHmmss
    $fileName = "Control_sum_of_artefacts_$dateTime.txt"
    Get-ChildItem -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber" -Recurse -Include *.txt -ErrorAction SilentlyContinue | 
        Get-FileHash -ErrorAction SilentlyContinue | 
        Where-Object { $_.Algorithm -in @('MD5', 'SHA1', 'SHA256') } | 
        Out-File "C:\Users\$env:UserName\Desktop\$fileName"
    Write-Host "Hashing Done !" -ForegroundColor Green
    Write-Host "All Done!, you can find the artefacts on your desktop, here: C:\Users\$env:UserName\Desktop\IOC-Grabber, Good Luck!"
}

# Crée le dossier parent si inexistant pour éviter des erreurs dès le début
if (!(Test-Path -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber")) {
    New-Item -ItemType Directory -Path "C:\Users\$env:UserName\Desktop\IOC-Grabber" | Out-Null
}

# Call the function 
Capturing